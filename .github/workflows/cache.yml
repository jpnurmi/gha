name: Cache

on:
  push:
    paths:
      - "**/cache.yml"
  workflow_dispatch:

jobs:
  save:
    runs-on: windows-11-arm

    steps:
      - run: echo "Hello from windows-11-arm" > hello.txt

      #- run: choco install --debug --verbose zstandard

      - shell: pwsh
        run: |
          $version = '1.5.7'
          Invoke-WebRequest -OutFile "$env:TEMP\zstd.zip" -Uri "https://github.com/facebook/zstd/releases/download/v$version/zstd-v$version-win64.zip" -OutFile
          $toolDir = "${{ runner.tool_cache }}\zstd\$version"
          New-Item -ItemType Directory -Path $toolDir -Force | Out-Null
          Expand-Archive -Path "$env:TEMP\zstd.zip" -DestinationPath $toolDir -Force
          echo "$toolDir" | Out-File -FilePath $env:GITHUB_PATH -Encoding utf8 -Append

      - uses: actions/cache@v4
        id: cache-hello
        with:
          path: hello.txt
          key: hello-key
          enableCrossOsArchive: true

  restore:
    needs: [save]
    runs-on: ubuntu-latest

    steps:
      - uses: actions/cache/restore@v4
        with:
          path: hello.txt
          key: hello-key
          enableCrossOsArchive: true
          fail-on-cache-miss: true
